@*
 * Copyright 2026 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import components.FileUpload

@this(
    layout: templates.Layout,
    formHelper: FormWithCSRF,
    govukErrorSummary: GovukErrorSummary,
    fileUpload: FileUpload,
    govukButton: GovukButton
)

@(form: Form[_],
    waypoints: Waypoints,
    period: Period,
    isIntermediary: Boolean,
    companyName: String,
    postTarget: String,
    formFields: Map[String, String],
    errorMessage: Option[String] = None
)(implicit request: Request[_], messages: Messages)

@caption = @{
    if(isIntermediary) {
        messages("fileUpload.intermediary.caption", companyName, period.displayText)
    } else {
        messages("fileUpload.caption", period.displayText)
    }
}

@layout(pageTitle = title(form, messages("fileUpload.title", period.displayText))) {

    @if(form.errors.nonEmpty) {
        @govukErrorSummary(ErrorSummaryViewModel(form))
    }

    <header class="hmrc-page-heading">
        <p class="govuk-caption-l hmrc-caption-l">@caption</p>
        <h1 class="govuk-heading-l">@messages("fileUpload.heading", period.displayText)</h1>
    </header>

    <p class="govuk-body">@messages("fileUpload.paragraph")</p>

    <ol class="govuk-list govuk-list--number">
        <li>@Html(messages("fileUpload.bullet1"))</li>
        <li>@messages("fileUpload.bullet2")</li>
        <li>@messages("fileUpload.bullet3")</li>

    </ol>

    <form action="@postTarget" method="POST" enctype="multipart/form-data">

        @for((name, value) <- formFields) {
            <input type="hidden" name="@name" value="@value">
        }

        <div id="file-upload-form-group">

            @fileUpload(
                form = form,
                errorMessage = errorMessage,
                name = "file",
                id = "file",
                label = "file",
                isPageHeading = false,
                attributes = Map("accept" -> ".csv", "required" -> "required")
            )
        </div>

        @govukButton(Button(
            attributes = Map("id" -> "file-upload-button"),
            classes = "govuk-!-margin-right-1",
            content = Text(messages("fileUpload.button"))
        ))
    </form>
}
